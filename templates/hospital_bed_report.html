{% load static %}  
<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <style>
    /* First page: 5cm top margin, includes date in header */
    @page :first {
        size: A4 portrait;
      - margin: 5cm 1cm 1cm 1cm;    
        @top-center    { content: element(firstHeader) }
        @bottom-center { content: "Page " counter(page) " of " counter(pages) }
      }

      /* All subsequent pages: 3cm top margin, no date in header */
      @page {
          size: A4 portrait;
          margin: 3cm 1cm 1cm 1cm;
          @top-center    { content: element(normalHeader) }
          @bottom-center { content: "Page " counter(page) " of " counter(pages) }
      }
  
      /* Running elements */
      #firstHeader { position: running(firstHeader) }
      #normalHeader { position: running(normalHeader) }
  
      /* Ensure table header repeats */
      thead { display: table-header-group; }
  
      /* Table beautification */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1em;
        font-size: 11px;
      }
      thead {
        background-color:rgb(82, 90, 130);
      }
      th {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: left;
        color: white
      } 
      td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: left;
      }
      tbody tr:nth-child(even) {
        background: #fafafa;
      }
  
      /* Chart sections start on new page */
      .chart-section {
        page-break-before: always;
        margin-top: 1em;
      }
      .chart-section img {
        display: block;
        margin: 0 auto 0.5em;
        max-width: 100%;
        height: auto;
      }
      .callouts {
        padding: 20px; 
        font-size: 20px;
        margin: 0 auto 1em;
        width: 80%;
      }

      .district-line {
        text-align: center;
        font-size: 10px;
        margin: 4px 0 8px;
      }
  </style>
</head><body>
  <header id="firstHeader">
    <img src="{{ logo_url }}" style="max-height:40px;float:left;margin-right:10px"/>
    <h2>{{ title }}</h2>
    <div class="date">Generated on {{ date }}</div>
    <div class="district-line">
      District:
      {% if report_districts %}{{ report_districts|join:", " }}{% else %}All{% endif %}
    </div><hr/>
  </header>
  <header id="normalHeader">
    <img src="{{ logo_url }}" style="max-height:40px;float:left;margin-right:10px"/>
    <h2>{{ title }}</h2><hr/>
  </header>
  <main>
    <section>
      <h3>Hospital Bed Violations</h3>
      <table>
        <thead>
          <tr>
            <th>#</th><th>Hospital ID</th><th>Name</th><th>District</th>
            <th>State</th><th>Capacity</th><th>Admissions</th>
            <th>Excess</th><th>Last Violation</th>
          </tr>
        </thead>
        <tbody>
          {% for r in table_rows %}
          <tr class="{% if r.excess > 0 %}excess-row{% endif %}">
            <td>{{ r.serial_no }}</td>
            <td>{{ r.hospital_id }}</td>
            <td>{{ r.hospital_name }}</td>
            <td>{{ r.district }}</td>
            <td>{{ r.state }}</td>
            <td>{{ r.bed_capacity }}</td>
            <td>{{ r.admissions }}</td>
            <td>{{ r.excess }}</td>
            <td>{{ r.last_violation }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    <section class="chart-section">
      <h3>District-wise Bed Violations</h3>
      <img src="data:image/png;base64,{{ hospital_chart_b64 }}" alt=""/>
      {% if hosp_bed_map_b64 %}
          <img src="data:image/png;base64,{{ hosp_bed_map_b64 }}" alt="Hospital Bed Violations Map">
      {% endif %}
    </section>
  </main>
</body></html>
