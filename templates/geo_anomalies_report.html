{% load static %}
<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <style>
    @page :first {
      size: A4 portrait; 
      margin:5cm 1cm 1cm 1cm;
      @top-center { content: element(firstHeader) }
      @bottom-center { content: "Page " counter(page) " of " counter(pages) }
    }
    @page {
      size: A4 portrait; 
      margin:3cm 1cm 1cm 1cm;
      @top-center { content: element(normalHeader) }
      @bottom-center { content: "Page " counter(page) " of " counter(pages) }
    }
    header#firstHeader  { position: running(firstHeader) }
    header#normalHeader { position: running(normalHeader) }
    thead { display: table-header-group }
    body { font-family:sans-serif; font-size:12px }
    header img { max-height:40px; float:left; margin-right:10px }
    header h2 { text-align:center; line-height:40px; margin:0; font-size:16px }
    header .date { text-align:center; font-size:10px }
    header hr    { border:none; border-bottom:1px solid #333; margin:5px 0 }
    .district-line { text-align:center; font-size:10px; margin:4px 0 8px }
    table { width:100%; border-collapse:collapse; margin-bottom:1em; font-size:11px }
    th,td { border:1px solid #ccc; padding:6px; text-align:left }
    thead { background:rgb(82,90,130); color:#fff }
    tbody tr:nth-child(even){ background:#fafafa }
    .chart-section { page-break-before: always; margin-top:1em }
    .chart-section img { display:block; margin:0 auto .5em; max-width:100% }
    .callouts { font-size:10px; margin:0 auto 1em; width:80% }
  </style>
</head><body>

  <header id="firstHeader">
    <img src="{{ logo_url }}" alt="Logo"/>
    <h2>{{ title }}</h2>
    <div class="date">Generated on {{ date }}</div>
    <hr/>
    <div class="district-line">
      District: {% if report_districts %}{{ report_districts|join:", " }}{% else %}All{% endif %}
    </div>
  </header>

  <header id="normalHeader">
    <img src="{{ logo_url }}" alt="Logo"/>
    <h2>{{ title }}</h2>
    <hr/>
  </header>

  <main>
    <!-- Table -->
    <section>
      <h3>Geographic Anomalies Cases</h3>
      <table>
        <thead>
          <tr>
            <th>#</th><th>Claim ID</th><th>Patient</th>
            <th>Hospital</th><th>District</th>
            <th>Patient State</th><th>Hospital State</th>
          </tr>
        </thead>
        <tbody>
          {% for r in table_rows %}
          <tr>
            <td>{{ r.serial_no }}</td>
            <td>{{ r.claim_id }}</td>
            <td>{{ r.patient_name }}</td>
            <td>{{ r.hospital_name }}</td>
            <td>{{ r.district }}</td>
            <td>{{ r.patient_state }}</td>
            <td>{{ r.hospital_state }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <!-- Bar Chart -->
    <section class="chart-section">
      <h3>State-wise Anomalies</h3>
      <img src="data:image/png;base64,{{ geo_chart_b64 }}" alt=""/>
    </section>

    <!-- Pie Charts -->
    <section class="chart-section">
      <h4>Age Distribution</h4>
      <img src="data:image/png;base64,{{ age_chart_b64 }}" alt=""/>
      <div class="callouts">{{ age_callouts|safe }}</div>

      <h4>Gender Distribution</h4>
      <img src="data:image/png;base64,{{ gender_chart_b64 }}" alt=""/>
      <div class="callouts">{{ gender_callouts|safe }}</div>
    </section>
  </main>
</body></html>
